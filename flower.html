<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Canvas Flower</title>
<style>
  :root{
    --bg:#0f1724;
    --panel:rgba(255,255,255,0.06);
    --text:#e6eef8;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
  body{
    background: radial-gradient(1200px 600px at 20% 20%, rgba(255,255,255,0.03), transparent),
                radial-gradient(1000px 500px at 80% 80%, rgba(255,255,255,0.02), transparent),
                var(--bg);
    color:var(--text);
    display:flex;gap:16px;
    align-items:center;justify-content:center;
    padding:18px;
    box-sizing:border-box;
  }
  .wrap{display:grid;grid-template-columns:1fr 320px;gap:16px;width:100%;max-width:1200px;height:80vh}
  canvas{width:100%;height:100%;border-radius:16px;box-shadow:0 6px 30px rgba(2,6,23,0.6);background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent)}
  .panel{
    padding:14px;border-radius:12px;background:var(--panel);
    backdrop-filter: blur(6px);display:flex;flex-direction:column;gap:12px;
    min-height:260px;
  }
  label{font-size:13px;opacity:0.9}
  input[type="range"]{width:100%}
  .row{display:flex;gap:8px;align-items:center}
  .small{font-size:12px;opacity:0.85}
  .color{display:flex;gap:6px;flex-wrap:wrap}
  .swatch{width:28px;height:28px;border-radius:8px;cursor:pointer;border:2px solid rgba(255,255,255,0.06)}
  button{padding:8px 10px;border-radius:8px;border:0;background:#1f6feb;color:white;cursor:pointer}
  .footer{margin-top:auto;font-size:12px;opacity:0.7}
  @media (max-width:900px){
    .wrap{grid-template-columns:1fr;grid-auto-rows:1fr 320px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <canvas id="c"></canvas>

    <div class="panel" aria-label="controls">
      <div>
        <label>Petals: <span id="petalCountLabel">12</span></label>
        <input id="petalCount" type="range" min="3" max="36" value="12">
      </div>

      <div>
        <label>Petal Length: <span id="petalLenLabel">1.0</span>x</label>
        <input id="petalLen" type="range" min="0.4" max="1.8" step="0.01" value="1">
      </div>

      <div>
        <label>Petal Width: <span id="petalWidthLabel">0.5</span>x</label>
        <input id="petalWidth" type="range" min="0.15" max="1.2" step="0.01" value="0.5">
      </div>

      <div>
        <label>Center radius: <span id="centerRLabel">36</span> px</label>
        <input id="centerR" type="range" min="10" max="120" value="36">
      </div>

      <div>
        <label class="small">Petal & center colors</label>
        <div class="color" id="colorBtns">
          <!-- swatches added by JS -->
        </div>
      </div>

      <div class="row">
        <input id="animate" type="checkbox" checked>
        <label for="animate" class="small">Animate (gentle bloom & rotate)</label>
      </div>

      <div class="row">
        <button id="randomize">Randomize</button>
        <button id="download">Download PNG</button>
      </div>

      <div class="footer">Tip: drag the canvas to reposition the flower; pinch on mobile to zoom.</div>
    </div>
  </div>

<script>
(() => {
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d', {alpha:true});
  // HiDPI canvas support
  function resizeCanvas(){
    const dpr = Math.min(window.devicePixelRatio || 1, 2);
    const rect = canvas.getBoundingClientRect();
    canvas.width = Math.round(rect.width * dpr);
    canvas.height = Math.round(rect.height * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  // Controls
  const petalCount = document.getElementById('petalCount');
  const petalLen = document.getElementById('petalLen');
  const petalWidth = document.getElementById('petalWidth');
  const centerR = document.getElementById('centerR');
  const animate = document.getElementById('animate');
  const randomize = document.getElementById('randomize');
  const download = document.getElementById('download');

  const petalCountLabel = document.getElementById('petalCountLabel');
  const petalLenLabel = document.getElementById('petalLenLabel');
  const petalWidthLabel = document.getElementById('petalWidthLabel');
  const centerRLabel = document.getElementById('centerRLabel');

  // Colors
  const colorBtns = document.getElementById('colorBtns');
  const paletteSets = [
    {petal:'#ff6b6b', center:'#ffd166'},
    {petal:'#ff7ab6', center:'#ffe6f0'},
    {petal:'#8be9a8', center:'#ffdb5c'},
    {petal:'#8bd3ff', center:'#ffe28b'},
    {petal:'#d6a4ff', center:'#fff3a8'},
    {petal:'#ffd08b', center:'#ff6b6b'}
  ];
  let colors = {...paletteSets[0]};

  function buildSwatches(){
    colorBtns.innerHTML = '';
    paletteSets.forEach((p,i)=>{
      const sw = document.createElement('div');
      sw.className='swatch';
      sw.title = 'Apply palette #' + (i+1);
      sw.style.background = `linear-gradient(135deg, ${p.petal} 40%, ${p.center} 40%)`;
      sw.addEventListener('click', ()=>{ colors = {...p}; });
      colorBtns.appendChild(sw);
    });
    // custom picker (petal + center)
    const custom = document.createElement('input');
    custom.type='color';
    custom.title='Pick petal color';
    custom.addEventListener('input', e => { colors.petal = e.target.value; });
    custom.className='swatch';
    custom.style.padding='0'; custom.style.borderRadius='8px';
    colorBtns.appendChild(custom);

    const custom2 = document.createElement('input');
    custom2.type='color';
    custom2.title='Pick center color';
    custom2.addEventListener('input', e => { colors.center = e.target.value; });
    custom2.className='swatch';
    custom2.style.padding='0'; custom2.style.borderRadius='8px';
    colorBtns.appendChild(custom2);
  }
  buildSwatches();

  // Interactive position + zoom
  let cx = 0.5, cy = 0.5, scale = 1;
  let dragging = false, last = null;
  canvas.addEventListener('pointerdown', e => {
    dragging = true;
    last = {x:e.clientX, y:e.clientY};
    canvas.setPointerCapture(e.pointerId);
  });
  window.addEventListener('pointermove', e => {
    if(!dragging) return;
    const rect = canvas.getBoundingClientRect();
    const dx = (e.clientX - last.x) / rect.width;
    const dy = (e.clientY - last.y) / rect.height;
    cx -= dx; cy -= dy;
    last = {x:e.clientX, y:e.clientY};
  });
  window.addEventListener('pointerup', e => { dragging=false; last=null; });

  canvas.addEventListener('wheel', e => {
    e.preventDefault();
    const delta = Math.sign(e.deltaY) * -0.05;
    scale = Math.max(0.4, Math.min(3, scale + delta));
  }, {passive:false});

  // helpers
  function lerp(a,b,t){return a + (b-a)*t}

  // labels update
  function updateLabels(){
    petalCountLabel.textContent = petalCount.value;
    petalLenLabel.textContent = parseFloat(petalLen.value).toFixed(2);
    petalWidthLabel.textContent = parseFloat(petalWidth.value).toFixed(2);
    centerRLabel.textContent = centerR.value;
  }
  [petalCount, petalLen, petalWidth, centerR].forEach(inp=>inp.addEventListener('input', updateLabels));
  updateLabels();

  // Randomizer
  randomize.addEventListener('click', ()=>{
    petalCount.value = Math.floor(Math.random()*28)+5;
    petalLen.value = (Math.random()*1.4 + 0.4).toFixed(2);
    petalWidth.value = (Math.random()*1.05 + 0.15).toFixed(2);
    centerR.value = Math.floor(Math.random()*100)+16;
    // random palette
    const p = paletteSets[Math.floor(Math.random()*paletteSets.length)];
    colors = {...p};
    updateLabels();
  });

  download.addEventListener('click', () => {
    const a = document.createElement('a');
    a.href = canvas.toDataURL('image/png');
    a.download = 'flower.png';
    a.click();
  });

  // Draw routine
  let t = 0;
  function draw(){
    resizeCanvas(); // adapt to layout changes
    const w = canvas.clientWidth;
    const h = canvas.clientHeight;
    ctx.clearRect(0,0,w,h);

    // background vignette
    const g = ctx.createRadialGradient(w*cx, h*cy, Math.min(w,h)*0.02, w*cx, h*cy, Math.max(w,h));
    g.addColorStop(0, 'rgba(255,255,255,0.03)');
    g.addColorStop(1, 'rgba(0,0,0,0.0)');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,w,h);

    // flower transformation
    ctx.save();
    ctx.translate(w*cx, h*cy);
    ctx.scale(scale, scale);

    const petals = parseInt(petalCount.value,10);
    const pLen = parseFloat(petalLen.value) * Math.min(w,h) * 0.18;
    const pWidth = parseFloat(petalWidth.value) * pLen;
    const centerRadius = parseFloat(centerR.value);

    // subtle animation values
    let bloom = 1;
    let rot = 0;
    if(animate.checked){
      bloom = 0.85 + 0.15 * Math.sin(t*0.9) + 0.1 * Math.sin(t*0.25);
      rot = 0.02 * Math.sin(t*0.6);
    }

    ctx.rotate(rot);

    // draw petals
    for(let i=0;i<petals;i++){
      const ang = i * (Math.PI*2 / petals);
      ctx.save();
      ctx.rotate(ang);

      // petal path as an ellipse-like bezier
      ctx.beginPath();
      // move to base
      ctx.moveTo(0, centerRadius * 0.35);
      // create a stretched petal using bezier curves
      const tipX = 0;
      const tipY = -pLen * bloom;
      const cp1x = pWidth * 0.6;
      const cp1y = -pLen * 0.35 * bloom;
      const cp2x = pWidth * 0.15;
      const cp2y = -pLen * 0.85 * bloom;
      ctx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, tipX, tipY);
      // other side
      ctx.bezierCurveTo(-cp2x, cp2y, -cp1x, cp1y, 0, centerRadius * 0.35);
      ctx.closePath();

      // petal gradient
      const pg = ctx.createLinearGradient(0, -pLen*bloom, 0, centerRadius);
      pg.addColorStop(0, lighten(colors.petal, 0.05));
      pg.addColorStop(0.6, colors.petal);
      pg.addColorStop(1, darken(colors.petal, 0.15));
      ctx.fillStyle = pg;
      ctx.fill();

      // highlight
      ctx.strokeStyle = 'rgba(255,255,255,0.06)';
      ctx.lineWidth = Math.max(1, pWidth*0.06);
      ctx.stroke();

      ctx.restore();
    }

    // center disk
    ctx.beginPath();
    ctx.arc(0,0, centerRadius * (0.9 + 0.05*Math.sin(t*1.2)), 0, Math.PI*2);
    const cg = ctx.createRadialGradient(-centerRadius*0.3,-centerRadius*0.3, centerRadius*0.05, 0,0, centerRadius);
    cg.addColorStop(0, 'rgba(255,255,255,0.9)');
    cg.addColorStop(0.2, colors.center);
    cg.addColorStop(1, darken(colors.center, 0.18));
    ctx.fillStyle = cg;
    ctx.fill();

    // tiny pollen specks
    const specks = Math.max(6, Math.floor(centerRadius/8));
    ctx.fillStyle = 'rgba(0,0,0,0.06)';
    for(let s=0;s<specks;s++){
      const a = Math.random()*Math.PI*2;
      const r = centerRadius * 0.5 * Math.sqrt(Math.random());
      ctx.beginPath();
      ctx.arc(Math.cos(a)*r, Math.sin(a)*r, Math.max(1, centerRadius*0.06*Math.random()), 0, Math.PI*2);
      ctx.fill();
    }

    ctx.restore();

    t += 0.03;
    requestAnimationFrame(draw);
  }

  // small color helpers
  function hexToRgb(h){
    const r = parseInt(h.slice(1,3),16);
    const g = parseInt(h.slice(3,5),16);
    const b = parseInt(h.slice(5,7),16);
    return [r,g,b];
  }
  function clamp(n,a,b){return Math.max(a,Math.min(b,n))}
  function lighten(hex,amt){
    const [r,g,b]=hexToRgb(hex);
    return `rgb(${clamp(Math.round(r + 255*amt),0,255)},${clamp(Math.round(g + 255*amt),0,255)},${clamp(Math.round(b + 255*amt),0,255)})`;
  }
  function darken(hex,amt){
    const [r,g,b]=hexToRgb(hex);
    return `rgb(${clamp(Math.round(r - 255*amt),0,255)},${clamp(Math.round(g - 255*amt),0,255)},${clamp(Math.round(b - 255*amt),0,255)})`;
  }

  // start
  draw();

  // keep UI labels reactive when values change programmatically
  const obs = new MutationObserver(updateLabels);
  obs.observe(petalCount, {attributes:true,attributeFilter:['value']});

  // accessibility: keyboard controls
  window.addEventListener('keydown', e=>{
    if(e.key === 'ArrowUp') scale = Math.min(scale+0.05,3);
    if(e.key === 'ArrowDown') scale = Math.max(scale-0.05,0.4);
  });

})();
</script>
</body>
</html>
